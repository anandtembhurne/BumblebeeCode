/*
Copyright 2012 Igor Vaynberg

Version: 3.4.1 Timestamp: Thu Jun 27 18:02:10 PDT 2013

This software is licensed under the Apache License, Version 2.0 (the "Apache License") or the GNU
General Public License version 2 (the "GPL License"). You may choose either license to govern your
use of this software only upon the condition that you accept all of the terms of either the Apache
License or the GPL License.

You may obtain a copy of the Apache License and the GPL License at:

http://www.apache.org/licenses/LICENSE-2.0
http://www.gnu.org/licenses/gpl-2.0.html

Unless required by applicable law or agreed to in writing, software distributed under the Apache License
or the GPL Licesnse is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied. See the Apache License and the GPL License for the specific language governing
permissions and limitations under the Apache License and the GPL License.
*/
!function(e){"undefined"==typeof e.fn.each2&&e.fn.extend({each2:function(t){for(var s=e([0]),i=-1,n=this.length;++i<n&&(s.context=s[0]=this[i])&&t.call(s[0],i,s)!==!1;);return this}})}(jQuery),function($,undefined){"use strict";function indexOf(e,t){for(var s=0,i=t.length;i>s;s+=1)if(equal(e,t[s]))return s;return-1}function measureScrollbar(){var e=$(MEASURE_SCROLLBAR_TEMPLATE);e.appendTo("body");var t={width:e.width()-e[0].clientWidth,height:e.height()-e[0].clientHeight};return e.remove(),t}function equal(e,t){return e===t?!0:e===undefined||t===undefined?!1:null===e||null===t?!1:e.constructor===String?e+""==t+"":t.constructor===String?t+""==e+"":!1}function splitVal(e,t){var s;return null===e||e.length<1?[]:s=e.split(t)}function getSideBorderPadding(e){return e.outerWidth(!1)-e.width()}function installKeyUpChangeEvent(e){var t="keyup-change-value";e.on("keydown",function(){$.data(e,t)===undefined&&$.data(e,t,e.val())}),e.on("keyup",function(){var s=$.data(e,t);s!==undefined&&e.val()!==s&&($.removeData(e,t),e.trigger("keyup-change"))})}function installFilteredMouseMove(e){e.on("mousemove",function(e){var t=lastMousePosition;(t===undefined||t.x!==e.pageX||t.y!==e.pageY)&&$(e.target).trigger("mousemove-filtered",e)})}function debounce(e,t,s){s=s||undefined;var i;return function(){var n=arguments;window.clearTimeout(i),i=window.setTimeout(function(){t.apply(s,n)},e)}}function thunk(e){var t,s=!1;return function(){return s===!1&&(t=e(),s=!0),t}}function installDebouncedScroll(e,t){var s=debounce(e,function(e){t.trigger("scroll-debounced",e)});t.on("scroll",function(e){indexOf(e.target,t.get())>=0&&s(e)})}function focus(e){e[0]!==document.activeElement&&window.setTimeout(function(){var t,s=e[0],i=e.val().length;e.focus(),e.is(":visible")&&s===document.activeElement&&(s.setSelectionRange?s.setSelectionRange(i,i):s.createTextRange&&(t=s.createTextRange(),t.collapse(!1),t.select()))},0)}function getCursorInfo(e){e=$(e)[0];var t=0,s=0;if("selectionStart"in e)t=e.selectionStart,s=e.selectionEnd-t;else if("selection"in document){e.focus();var i=document.selection.createRange();s=document.selection.createRange().text.length,i.moveStart("character",-e.value.length),t=i.text.length-s}return{offset:t,length:s}}function killEvent(e){e.preventDefault(),e.stopPropagation()}function killEventImmediately(e){e.preventDefault(),e.stopImmediatePropagation()}function measureTextWidth(e){if(!sizer){var t=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,letterSpacing:t.letterSpacing,textTransform:t.textTransform,whiteSpace:"nowrap"}),sizer.attr("class","select2-sizer"),$("body").append(sizer)}return sizer.text(e.val()),sizer.width()}function syncCssClasses(e,t,s){var i,n,o=[];i=e.attr("class"),i&&(i=""+i,$(i.split(" ")).each2(function(){0===this.indexOf("select2-")&&o.push(this)})),i=t.attr("class"),i&&(i=""+i,$(i.split(" ")).each2(function(){0!==this.indexOf("select2-")&&(n=s(this),n&&o.push(this))})),e.attr("class",o.join(" "))}function markMatch(e,t,s,i){var n=e.toUpperCase().indexOf(t.toUpperCase()),o=t.length;return 0>n?void s.push(i(e)):(s.push(i(e.substring(0,n))),s.push("<span class='select2-match'>"),s.push(i(e.substring(n,n+o))),s.push("</span>"),void s.push(i(e.substring(n+o,e.length))))}function defaultEscapeMarkup(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})}function ajax(e){var t,s=0,i=null,n=e.quietMillis||100,o=e.url,a=this;return function(l){window.clearTimeout(t),t=window.setTimeout(function(){s+=1;var t=s,n=e.data,c=o,r=e.transport||$.fn.select2.ajaxDefaults.transport,h={type:e.type||"GET",cache:e.cache||!1,jsonpCallback:e.jsonpCallback||undefined,dataType:e.dataType||"json"},d=$.extend({},$.fn.select2.ajaxDefaults.params,h);n=n?n.call(a,l.term,l.page,l.context):null,c="function"==typeof c?c.call(a,l.term,l.page,l.context):c,i&&i.abort(),e.params&&($.isFunction(e.params)?$.extend(d,e.params.call(a)):$.extend(d,e.params)),$.extend(d,{url:c,dataType:e.dataType,data:n,success:function(i){if(!(s>t)){var n=e.results(i,l.page);l.callback(n)}}}),i=r.call(a,d)},n)}}function local(e){var t,s,i=e,n=function(e){return""+e.text};$.isArray(i)&&(s=i,i={results:s}),$.isFunction(i)===!1&&(s=i,i=function(){return s});var o=i();return o.text&&(n=o.text,$.isFunction(n)||(t=o.text,n=function(e){return e[t]})),function(e){var t,s=e.term,o={results:[]};return""===s?void e.callback(i()):(t=function(i,o){var a,l;if(i=i[0],i.children){a={};for(l in i)i.hasOwnProperty(l)&&(a[l]=i[l]);a.children=[],$(i.children).each2(function(e,s){t(s,a.children)}),(a.children.length||e.matcher(s,n(a),i))&&o.push(a)}else e.matcher(s,n(i),i)&&o.push(i)},$(i().results).each2(function(e,s){t(s,o.results)}),void e.callback(o))}}function tags(e){var t=$.isFunction(e);return function(s){var i=s.term,n={results:[]};$(t?e():e).each(function(){var e=this.text!==undefined,t=e?this.text:this;(""===i||s.matcher(i,t))&&n.results.push(e?this:{id:this,text:this})}),s.callback(n)}}function checkFormatter(e,t){if($.isFunction(e))return!0;if(!e)return!1;throw new Error(t+" must be a function or a falsy value")}function evaluate(e){return $.isFunction(e)?e():e}function countResults(e){var t=0;return $.each(e,function(e,s){s.children?t+=countResults(s.children):t++}),t}function defaultTokenizer(e,t,s,i){var n,o,a,l,c,r=e,h=!1;if(!i.createSearchChoice||!i.tokenSeparators||i.tokenSeparators.length<1)return undefined;for(;;){for(o=-1,a=0,l=i.tokenSeparators.length;l>a&&(c=i.tokenSeparators[a],o=e.indexOf(c),!(o>=0));a++);if(0>o)break;if(n=e.substring(0,o),e=e.substring(o+c.length),n.length>0&&(n=i.createSearchChoice.call(this,n,t),n!==undefined&&null!==n&&i.id(n)!==undefined&&null!==i.id(n))){for(h=!1,a=0,l=t.length;l>a;a++)if(equal(i.id(n),i.id(t[a]))){h=!0;break}h||s(n)}}return r!==e?e:void 0}function clazz(e,t){var s=function(){};return s.prototype=new e,s.prototype.constructor=s,s.prototype.parent=e.prototype,s.prototype=$.extend(s.prototype,t),s}if(window.Select2===undefined){var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer,lastMousePosition={x:0,y:0},$document,scrollBarDimensions,KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e}},MEASURE_SCROLLBAR_TEMPLATE="<div class='select2-measure-scrollbar'></div>";$document=$(document),nextUid=function(){var e=1;return function(){return e++}}(),$document.on("mousemove",function(e){lastMousePosition.x=e.pageX,lastMousePosition.y=e.pageY}),AbstractSelect2=clazz(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(e){var t,s,i,n,o=".select2-results";this.opts=e=this.prepareOpts(e),this.id=e.id,e.element.data("select2")!==undefined&&null!==e.element.data("select2")&&e.element.data("select2").destroy(),this.container=this.createContainer(),this.containerId="s2id_"+(e.element.attr("id")||"autogen"+nextUid()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=thunk(function(){return e.element.closest("body")}),syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.css(evaluate(e.containerCss)),this.container.addClass(evaluate(e.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(evaluate(e.dropdownCssClass)),this.dropdown.data("select2",this),this.results=t=this.container.find(o),this.search=s=this.container.find("input.select2-input"),this.resultsPage=0,this.context=null,this.initContainer(),installFilteredMouseMove(this.results),this.dropdown.on("mousemove-filtered touchstart touchmove touchend",o,this.bind(this.highlightUnderEvent)),installDebouncedScroll(80,this.results),this.dropdown.on("scroll-debounced",o,this.bind(this.loadMoreIfNeeded)),$(this.container).on("change",".select2-input",function(e){e.stopPropagation()}),$(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation()}),$.fn.mousewheel&&t.mousewheel(function(e,s,i,n){var o=t.scrollTop();n>0&&0>=o-n?(t.scrollTop(0),killEvent(e)):0>n&&t.get(0).scrollHeight-t.scrollTop()+n<=t.height()&&(t.scrollTop(t.get(0).scrollHeight-t.height()),killEvent(e))}),installKeyUpChangeEvent(s),s.on("keyup-change input paste",this.bind(this.updateResults)),s.on("focus",function(){s.addClass("select2-focused")}),s.on("blur",function(){s.removeClass("select2-focused")}),this.dropdown.on("mouseup",o,this.bind(function(e){$(e.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(e),this.selectHighlighted(e))})),this.dropdown.on("click mouseup mousedown",function(e){e.stopPropagation()}),$.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==e.maximumInputLength&&this.search.attr("maxlength",e.maximumInputLength);var i=e.element.prop("disabled");i===undefined&&(i=!1),this.enable(!i);var n=e.element.prop("readonly");n===undefined&&(n=!1),this.readonly(n),scrollBarDimensions=scrollBarDimensions||measureScrollbar(),this.autofocus=e.element.prop("autofocus"),e.element.prop("autofocus",!1),this.autofocus&&this.focus()},destroy:function(){var e=this.opts.element,t=e.data("select2");this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),t!==undefined&&(t.container.remove(),t.dropdown.remove(),e.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?e.attr({tabindex:this.elementTabIndex}):e.removeAttr("tabindex"),e.show())},optionToData:function(e){return e.is("option")?{id:e.prop("value"),text:e.text(),element:e.get(),css:e.attr("class"),disabled:e.prop("disabled"),locked:equal(e.attr("locked"),"locked")||equal(e.data("locked"),!0)}:e.is("optgroup")?{text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")}:void 0},prepareOpts:function(e){var t,s,i,n,o=this;if(t=e.element,"select"===t.get(0).tagName.toLowerCase()&&(this.select=s=e.element),s&&$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in e)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),e=$.extend({},{populateResults:function(t,s,i){var n,a=this.opts.id;(n=function(t,s,l){var c,r,h,d,u,p,f,g,m,v;for(t=e.sortResults(t,s,i),c=0,r=t.length;r>c;c+=1)h=t[c],u=h.disabled===!0,d=!u&&a(h)!==undefined,p=h.children&&h.children.length>0,f=$("<li></li>"),f.addClass("select2-results-dept-"+l),f.addClass("select2-result"),f.addClass(d?"select2-result-selectable":"select2-result-unselectable"),u&&f.addClass("select2-disabled"),p&&f.addClass("select2-result-with-children"),f.addClass(o.opts.formatResultCssClass(h)),g=$(document.createElement("div")),g.addClass("select2-result-label"),v=e.formatResult(h,g,i,o.opts.escapeMarkup),v!==undefined&&g.html(v),f.append(g),p&&(m=$("<ul></ul>"),m.addClass("select2-result-sub"),n(h.children,m,l+1),f.append(m)),f.data("select2-data",h),s.append(f)})(s,t,0)}},$.fn.select2.defaults,e),"function"!=typeof e.id&&(i=e.id,e.id=function(e){return e[i]}),$.isArray(e.element.data("select2Tags"))){if("tags"in e)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+e.element.attr("id");e.tags=e.element.data("select2Tags")}if(s?(e.query=this.bind(function(e){var s,i,n,a={results:[],more:!1},l=e.term;n=function(t,s){var i;t.is("option")?e.matcher(l,t.text(),t)&&s.push(o.optionToData(t)):t.is("optgroup")&&(i=o.optionToData(t),t.children().each2(function(e,t){n(t,i.children)}),i.children.length>0&&s.push(i))},s=t.children(),this.getPlaceholder()!==undefined&&s.length>0&&(i=this.getPlaceholderOption(),i&&(s=s.not(i))),s.each2(function(e,t){n(t,a.results)}),e.callback(a)}),e.id=function(e){return e.id},e.formatResultCssClass=function(e){return e.css}):"query"in e||("ajax"in e?(n=e.element.data("ajax-url"),n&&n.length>0&&(e.ajax.url=n),e.query=ajax.call(e.element,e.ajax)):"data"in e?e.query=local(e.data):"tags"in e&&(e.query=tags(e.tags),e.createSearchChoice===undefined&&(e.createSearchChoice=function(e){return{id:e,text:e}}),e.initSelection===undefined&&(e.initSelection=function(t,s){var i=[];$(splitVal(t.val(),e.separator)).each(function(){var t=this,s=this,n=e.tags;$.isFunction(n)&&(n=n()),$(n).each(function(){return equal(this.id,t)?(s=this.text,!1):void 0}),i.push({id:t,text:s})}),s(i)}))),"function"!=typeof e.query)throw"query function not defined for Select2 "+e.element.attr("id");return e},monitorSource:function(){var e,t=this.opts.element;t.on("change.select2",this.bind(function(){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()})),e=this.bind(function(){var e,s=t.prop("disabled");s===undefined&&(s=!1),this.enable(!s);var e=t.prop("readonly");e===undefined&&(e=!1),this.readonly(e),syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(evaluate(this.opts.containerCssClass)),syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(evaluate(this.opts.dropdownCssClass))}),t.on("propertychange.select2 DOMAttrModified.select2",e),this.mutationCallback===undefined&&(this.mutationCallback=function(t){t.forEach(e)}),"undefined"!=typeof WebKitMutationObserver&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new WebKitMutationObserver(this.mutationCallback),this.propertyObserver.observe(t.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(e){var t=$.Event("select2-selecting",{val:this.id(e),object:e});return this.opts.element.trigger(t),!t.isDefaultPrevented()},triggerChange:function(e){e=e||{},e=$.extend({},e,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(e),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return this.enabledInterface===!0},enableInterface:function(){var e=this._enabled&&!this._readonly,t=!e;return e===this.enabledInterface?!1:(this.container.toggleClass("select2-container-disabled",t),this.close(),this.enabledInterface=e,!0)},enable:function(e){return e===undefined&&(e=!0),this._enabled===e?!1:(this._enabled=e,this.opts.element.prop("disabled",!e),this.enableInterface(),!0)},readonly:function(e){return e===undefined&&(e=!1),this._readonly===e?!1:(this._readonly=e,this.opts.element.prop("readonly",e),this.enableInterface(),!0)},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var e,t,s,i,n=this.dropdown,o=this.container.offset(),a=this.container.outerHeight(!1),l=this.container.outerWidth(!1),c=n.outerHeight(!1),r=$(window).scrollLeft()+$(window).width(),h=$(window).scrollTop()+$(window).height(),d=o.top+a,u=o.left,p=h>=d+c,f=o.top-c>=this.body().scrollTop(),g=n.outerWidth(!1),m=r>=u+g,v=n.hasClass("select2-drop-above");this.opts.dropdownAutoWidth?(i=$(".select2-results",n)[0],n.addClass("select2-drop-auto-width"),n.css("width",""),g=n.outerWidth(!1)+(i.scrollHeight===i.clientHeight?0:scrollBarDimensions.width),g>l?l=g:g=l,m=r>=u+g):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body().css("position")&&(e=this.body().offset(),d-=e.top,u-=e.left),v?(t=!0,!f&&p&&(t=!1)):(t=!1,!p&&f&&(t=!0)),m||(u=o.left+l-g),t?(d=o.top-c,this.container.addClass("select2-drop-above"),n.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),n.removeClass("select2-drop-above")),s=$.extend({top:d,left:u,width:l},evaluate(this.opts.dropdownCss)),n.css(s)},shouldOpen:function(){var e;return this.opened()?!1:this._enabled===!1||this._readonly===!0?!1:(e=$.Event("select2-opening"),this.opts.element.trigger(e),!e.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(this.opening(),!0):!1},opening:function(){function e(){return{width:Math.max(document.documentElement.scrollWidth,$(window).width()),height:Math.max(document.documentElement.scrollHeight,$(window).height())}}var t,s,i=this.containerId,n="scroll."+i,o="resize."+i,a="orientationchange."+i;if(this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body().children().last()[0]){var l=this.dropdown.width();this.dropdown.detach().appendTo(this.body()),this.dropdown.width(l)}t=$("#select2-drop-mask"),0==t.length&&(t=$(document.createElement("div")),t.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),t.hide(),t.appendTo(this.body()),t.on("mousedown touchstart click",function(e){var t,s=$("#select2-drop");s.length>0&&(t=s.data("select2"),t.opts.selectOnBlur&&t.selectHighlighted({noFocus:!0}),t.close(),e.preventDefault(),e.stopPropagation())})),this.dropdown.prev()[0]!==t[0]&&this.dropdown.before(t),$("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),s=e(),t.css(s).show(),this.dropdown.show(),(!this.opts.autocomplete||this.search.val().length>0)&&this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var c=this;this.container.parents().add(window).each(function(){$(this).on(o+" "+n+" "+a,function(){var t=e();$("#select2-drop-mask").css(t),c.positionDropdown()})})},close:function(){if(this.opened()){var e=this.containerId,t="scroll."+e,s="resize."+e,i="orientationchange."+e;this.container.parents().add(window).each(function(){$(this).off(t).off(s).off(i)}),this.clearDropdownAlignmentPreference(),$("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open"),this.results.empty(),this.opts.autocomplete||this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger($.Event("select2-close"))}},externalSearch:function(e){this.open(),this.search.val(e),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return evaluate(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var e,t,s,i,n,o,a,l=this.results;if(t=this.highlight(),!(0>t)){if(0==t)return void l.scrollTop(0);e=this.findHighlightableChoices().find(".select2-result-label"),s=$(e[t]),i=s.offset().top+s.outerHeight(!0),t===e.length-1&&(a=l.find("li.select2-more-results"),a.length>0&&(i=a.offset().top+a.outerHeight(!0))),n=l.offset().top+l.outerHeight(!0),i>n&&l.scrollTop(l.scrollTop()+(i-n)),o=s.offset().top-l.offset().top,0>o&&"none"!=s.css("display")&&l.scrollTop(l.scrollTop()+o)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)")},moveHighlight:function(e){for(var t=this.findHighlightableChoices(),s=this.highlight();s>-1&&s<t.length;){s+=e;var i=$(t[s]);if(i.hasClass("select2-result-selectable")&&!i.hasClass("select2-disabled")&&!i.hasClass("select2-selected")){this.highlight(s);break}}},highlight:function(e){var t,s,i=this.findHighlightableChoices();return 0===arguments.length?indexOf(i.filter(".select2-highlighted")[0],i.get()):(e>=i.length&&(e=i.length-1),0>e&&(e=0),this.results.find(".select2-highlighted").removeClass("select2-highlighted"),t=$(i[e]),t.addClass("select2-highlighted"),this.ensureHighlightVisible(),s=t.data("select2-data"),void(s&&this.opts.element.trigger({type:"select2-highlight",val:this.id(s),choice:s})))},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(e){var t=$(e.target).closest(".select2-result-selectable");if(t.length>0&&!t.is(".select2-highlighted")){var s=this.findHighlightableChoices();this.highlight(s.index(t))}else 0==t.length&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e,t=this.results,s=t.find("li.select2-more-results"),i=this.resultsPage+1,n=this,o=this.search.val(),a=this.context;0!==s.length&&(e=s.offset().top-t.offset().top-t.height(),e<=this.opts.loadMorePadding&&(s.addClass("select2-active"),this.opts.query({element:this.opts.element,term:o,page:i,context:a,matcher:this.opts.matcher,callback:this.bind(function(e){n.opened()&&(n.opts.populateResults.call(this,t,e.results,{term:o,page:i,context:a}),n.postprocessResults(e,!1,!1),e.more===!0?(s.detach().appendTo(t).text(n.opts.formatLoadMore(i+1)),window.setTimeout(function(){n.loadMoreIfNeeded()},10)):s.remove(),n.positionDropdown(),n.resultsPage=i,n.context=e.context)})})))},tokenize:function(){},updateResults:function(e){function t(){o.removeClass("select2-active"),c.positionDropdown()}function s(e){a.html(e),t()}var i,n,o=this.search,a=this.results,l=this.opts,c=this,r=o.val(),h=$.data(this.container,"select2-last-term");if((e===!0||!h||!equal(r,h))&&($.data(this.container,"select2-last-term",r),e===!0||this.showSearchInput!==!1&&this.opened())){var d=this.getMaximumSelectionSize();if(d>=1&&(i=this.data(),$.isArray(i)&&i.length>=d&&checkFormatter(l.formatSelectionTooBig,"formatSelectionTooBig")))return void s("<li class='select2-selection-limit'>"+l.formatSelectionTooBig(d)+"</li>");if(o.val().length<l.minimumInputLength)return this.opts.autocomplete||s(checkFormatter(l.formatInputTooShort,"formatInputTooShort")?"<li class='select2-no-results'>"+l.formatInputTooShort(o.val(),l.minimumInputLength)+"</li>":""),void(e&&this.showSearch&&this.showSearch(!0));if(l.maximumInputLength&&o.val().length>l.maximumInputLength)return void s(checkFormatter(l.formatInputTooLong,"formatInputTooLong")?"<li class='select2-no-results'>"+l.formatInputTooLong(o.val(),l.maximumInputLength)+"</li>":"");l.formatSearching&&0===this.findHighlightableChoices().length&&s("<li class='select2-searching'>"+l.formatSearching()+"</li>"),o.addClass("select2-active"),n=this.tokenize(),n!=undefined&&null!=n&&o.val(n),this.resultsPage=1,l.query({element:l.element,term:o.val(),page:this.resultsPage,context:null,matcher:l.matcher,callback:this.bind(function(i){var n;return this.opened()?(this.context=i.context===undefined?null:i.context,this.opts.createSearchChoice&&""!==o.val()&&(n=this.opts.createSearchChoice.call(c,o.val(),i.results),n!==undefined&&null!==n&&c.id(n)!==undefined&&null!==c.id(n)&&0===$(i.results).filter(function(){return equal(c.id(this),c.id(n))}).length&&i.results.unshift(n)),0===i.results.length&&checkFormatter(l.formatNoMatches,"formatNoMatches")?void s("<li class='select2-no-results'>"+l.formatNoMatches(o.val())+"</li>"):(a.empty(),c.opts.populateResults.call(this,a,i.results,{term:o.val(),page:this.resultsPage,context:null}),i.more===!0&&checkFormatter(l.formatLoadMore,"formatLoadMore")&&(a.append("<li class='select2-more-results'>"+c.opts.escapeMarkup(l.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){c.loadMoreIfNeeded()},10)),this.postprocessResults(i,e),t(),void this.opts.element.trigger({type:"select2-loaded",items:i}))):void this.search.removeClass("select2-active")})})}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){focus(this.search)},selectHighlighted:function(e){var t=this.highlight(),s=this.results.find(".select2-highlighted"),i=s.closest(".select2-result").data("select2-data");i?(this.highlight(t),this.onSelect(i,e)):e&&e.noFocus&&this.close()},getPlaceholder:function(){var e;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((e=this.getPlaceholderOption())!==undefined?e.text():undefined)},getPlaceholderOption:function(){if(this.select){var e=this.select.children().first();if(this.opts.placeholderOption!==undefined)return"first"===this.opts.placeholderOption&&e||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===e.text()&&""===e.val())return e}},initContainerWidth:function(){function e(){var e,t,s,i,n;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if(e=this.opts.element.attr("style"),e!==undefined)for(t=e.split(";"),i=0,n=t.length;n>i;i+=1)if(s=t[i].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==s&&s.length>=1)return s[1];return"resolve"===this.opts.width?(e=this.opts.element.css("width"),e.indexOf("%")>0?e:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return $.isFunction(this.opts.width)?this.opts.width():this.opts.width}var t=e.call(this);null!==t&&this.container.css("width",t)}}),SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var e=$(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow'><b></b></span>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return e},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var e,t,s;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),this.showSearchInput!==!1&&this.search.val(this.focusser.val()),this.search.focus(),e=this.search.get(0),e.createTextRange?(t=e.createTextRange(),t.collapse(!1),t.select()):e.setSelectionRange&&(s=this.search.val().length,e.setSelectionRange(s,s)),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger($.Event("select2-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus()},initContainer:function(){var e,t=this.container,s=this.dropdown;this.showSearch(this.opts.minimumResultsForSearch<0?!1:!0),this.selection=e=t.find(".select2-choice"),this.focusser=t.find(".select2-focusser"),this.focusser.attr("id","s2id_autogen"+nextUid()),$("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id")),this.focusser.attr("tabindex",this.elementTabIndex),this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN)return void killEvent(e);switch(e.which){case KEY.UP:case KEY.DOWN:return this.moveHighlight(e.which===KEY.UP?-1:1),void killEvent(e);case KEY.ENTER:return this.selectHighlighted(),void killEvent(e);case KEY.TAB:return void this.selectHighlighted({noFocus:!0});case KEY.ESC:return this.cancel(e),void killEvent(e)}}})),this.search.on("blur",this.bind(function(){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.ESC){if(this.opts.openOnEnter===!1&&e.which===KEY.ENTER)return void killEvent(e);if(e.which==KEY.DOWN||e.which==KEY.UP||e.which==KEY.ENTER&&this.opts.openOnEnter){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;return this.open(),void killEvent(e)}return e.which==KEY.DELETE||e.which==KEY.BACKSPACE?(this.opts.allowClear&&this.clear(),void killEvent(e)):void 0}})),installKeyUpChangeEvent(this.focusser),this.focusser.on("keyup-change input",this.bind(function(e){if(this.opts.minimumResultsForSearch>=0){if(e.stopPropagation(),this.opened())return;this.open()}})),e.on("mousedown","abbr",this.bind(function(e){this.isInterfaceEnabled()&&(this.clear(),killEventImmediately(e),this.close(),this.selection.focus())}));var i=function(e){this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),killEvent(e)};this.opts.dropdownOnArrow===!0?e.on("mousedown",".select2-arrow",this.bind(i)):e.on("mousedown",this.bind(i)),s.on("mousedown",this.bind(function(){this.search.focus()})),e.on("focus",this.bind(function(e){killEvent(e)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger($.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(e){var t=this.selection.data("select2-data");if(t){var s=this.getPlaceholderOption();this.opts.element.val(s?s.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),e!==!1&&(this.opts.element.trigger({type:"select2-removed",val:this.id(t),choice:t}),this.triggerChange({removed:t}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection([]),this.close(),this.setPlaceholder();else{var e=this;this.opts.initSelection.call(null,this.opts.element,function(t){t!==undefined&&null!==t&&(e.updateSelection(t),e.close(),e.setPlaceholder())})}},isPlaceholderOptionSelected:function(){var e;return(e=this.getPlaceholderOption())!==undefined&&e.is(":selected")||""===this.opts.element.val()||this.opts.element.val()===undefined||null===this.opts.element.val()},prepareOpts:function(){var e=this.parent.prepareOpts.apply(this,arguments),t=this;return"select"===e.element.get(0).tagName.toLowerCase()?e.initSelection=function(e,s){var i=e.find(":selected");s(t.optionToData(i))}:"data"in e&&(e.initSelection=e.initSelection||function(t,s){var i=t.val(),n=null;e.query({matcher:function(t,s,o){var a=equal(i,e.id(o));return a&&(n=o),a},callback:$.isFunction(s)?function(){s(n)}:$.noop})}),e},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===undefined?undefined:this.parent.getPlaceholder.apply(this,arguments)
},setPlaceholder:function(){var e=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&e!==undefined){if(this.select&&this.getPlaceholderOption()===undefined)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(e,t,s){var i=0,n=this;if(this.findHighlightableChoices().each2(function(e,t){return equal(n.id(t.data("select2-data")),n.opts.element.val())?(i=e,!1):void 0}),s!==!1&&this.highlight(t===!0&&i>=0?i:0),t===!0){var o=this.opts.minimumResultsForSearch;o>=0&&this.showSearch(countResults(e.results)>=o)}},showSearch:function(e){this.showSearchInput!==e&&(this.showSearchInput=e,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!e),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!e),$(this.dropdown,this.container).toggleClass("select2-with-searchbox",e))},onSelect:function(e,t){if(this.triggerSelect(e)){var s=this.opts.element.val(),i=this.data();this.opts.element.val(this.id(e)),this.updateSelection(e),this.opts.element.trigger({type:"select2-selected",val:this.id(e),choice:e}),this.close(),t&&t.noFocus||this.selection.focus(),equal(s,this.id(e))||this.triggerChange({added:e,removed:i})}},updateSelection:function(e){var t,s,i=this.selection.find(".select2-chosen");this.selection.data("select2-data",e),i.empty(),t=this.opts.formatSelection(e,i,this.opts.escapeMarkup),t!==undefined&&i.append(t),s=this.opts.formatSelectionCssClass(e,i),s!==undefined&&i.addClass(s),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==undefined&&this.container.addClass("select2-allowclear")},val:function(){var e,t=!1,s=null,i=this,n=this.data();if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],arguments.length>1&&(t=arguments[1]),this.select)this.select.val(e).find(":selected").each2(function(e,t){return s=i.optionToData(t),!1}),this.updateSelection(s),this.setPlaceholder(),t&&this.triggerChange({added:s,removed:n});else{if(!e&&0!==e)return void this.clear(t);if(this.opts.initSelection===undefined)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){i.opts.element.val(e?i.id(e):""),i.updateSelection(e),i.setPlaceholder(),t&&i.triggerChange({added:e,removed:n})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(e,t){var s;return 0===arguments.length?(s=this.selection.data("select2-data"),s==undefined&&(s=null),s):void(e&&""!==e?(s=this.data(),this.opts.element.val(e?this.id(e):""),this.updateSelection(e),t&&this.triggerChange({added:e,removed:s})):this.clear(t))}}),MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var e=$(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' autocorrect='off' autocapitilize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return e},prepareOpts:function(){var e=this.parent.prepareOpts.apply(this,arguments),t=this;return"select"===e.element.get(0).tagName.toLowerCase()?e.initSelection=function(e,s){var i=[];e.find(":selected").each2(function(e,s){i.push(t.optionToData(s))}),s(i)}:"data"in e&&(e.initSelection=e.initSelection||function(t,s){var i=splitVal(t.val(),e.separator),n=[];e.query({matcher:function(t,s,o){var a=$.grep(i,function(t){return equal(t,e.id(o))}).length;return a&&n.push(o),a},callback:$.isFunction(s)?function(){for(var t=[],o=0;o<i.length;o++)for(var a=i[o],l=0;l<n.length;l++){var c=n[l];if(equal(a,e.id(c))){t.push(c),n.splice(l,1);break}}s(t)}:$.noop})}),e},selectChoice:function(e){var t=this.container.find(".select2-search-choice-focus");t.length&&e&&e[0]==t[0]||(t.length&&this.opts.element.trigger("choice-deselected",t),t.removeClass("select2-search-choice-focus"),e&&e.length&&(this.close(),e.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",e)))},initContainer:function(){var selector=".select2-choices",selection;this.searchContainer=this.container.find(".select2-search-field"),this.selection=selection=this.container.find(selector);var _this=this;this.selection.on("mousedown",".select2-search-choice",function(){_this.search[0].focus(),_this.selectChoice($(this))}),this.search.attr("id","s2id_autogen"+nextUid()),$("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var selected=selection.find(".select2-search-choice-focus"),prev=selected.prev(".select2-search-choice:not(.select2-locked)"),next=selected.next(".select2-search-choice:not(.select2-locked)"),pos=getCursorInfo(this.search);if(selected.length&&(e.which==KEY.LEFT||e.which==KEY.RIGHT||e.which==KEY.BACKSPACE||e.which==KEY.DELETE||e.which==KEY.ENTER)){var selectedChoice=selected;return e.which==KEY.LEFT&&prev.length?selectedChoice=prev:e.which==KEY.RIGHT?selectedChoice=next.length?next:null:e.which===KEY.BACKSPACE?(this.unselect(selected.first()),this.search.width(10),selectedChoice=prev.length?prev:next):e.which==KEY.DELETE?(this.unselect(selected.first()),this.search.width(10),selectedChoice=next.length?next:null):e.which==KEY.ENTER&&(selectedChoice=null),this.selectChoice(selectedChoice),killEvent(e),void(selectedChoice&&selectedChoice.length||this.open())}if((e.which===KEY.BACKSPACE&&1==this.keydowns||e.which==KEY.LEFT)&&0==pos.offset&&!pos.length)return this.selectChoice(selection.find(".select2-search-choice:not(.select2-locked)").last()),void killEvent(e);if(this.selectChoice(null),this.opened())switch(e.which){case KEY.UP:case KEY.DOWN:return this.moveHighlight(e.which===KEY.UP?-1:1),void killEvent(e);case KEY.ENTER:return void(null!=this.opts.enterKeyHandler?(eval(this.opts.enterKeyHandler)(this.search.val()),killEvent(e)):(this.selectHighlighted(),killEvent(e)));case KEY.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case KEY.ESC:return this.cancel(e),void killEvent(e)}if(e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.BACKSPACE&&e.which!==KEY.ESC){if(e.which===KEY.ENTER){if(this.opts.openOnEnter===!1)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN)&&killEvent(e),e.which===KEY.ENTER&&killEvent(e)}}})),this.search.on("keyup",this.bind(function(){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),e.stopImmediatePropagation(),this.opts.element.trigger($.Event("select2-blur"))})),this.container.on("click",selector,this.bind(function(e){this.isInterfaceEnabled()&&($(e.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.open(),this.focusSearch(),e.preventDefault()))})),this.container.on("focus",selector,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var e=this;this.opts.initSelection.call(null,this.opts.element,function(t){t!==undefined&&null!==t&&(e.updateSelection(t),e.close(),e.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder(),t=this.getMaxSearchWidth();e!==undefined&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.search.width(t>0?t:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.updateResults(!0),this.search.focus(),this.opts.element.trigger($.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(e){var t=[],s=[],i=this;$(e).each(function(){indexOf(i.id(this),t)<0&&(t.push(i.id(this)),s.push(this))}),e=s,this.selection.find(".select2-search-choice").remove(),$(e).each(function(){i.addSelectedChoice(this)}),i.postprocessResults()},tokenize:function(){var e=this.search.val();e=this.opts.tokenizer.call(this,e,this.data(),this.bind(this.onSelect),this.opts),null!=e&&e!=undefined&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e,t){this.triggerSelect(e)&&(this.addSelectedChoice(e),this.opts.element.trigger({type:"selected",val:this.id(e),choice:e}),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:e}),t&&t.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(e){if(this.opts.autocomplete)return void this.selection.find(".select2-search-field input").val(e.label);var t,s,i=!e.locked,n=$("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),o=$("<li class='select2-search-choice select2-locked'><div></div></li>"),a=i?n:o,l=this.id(e),c=this.getVal();t=this.opts.formatSelection(e,a.find("div"),this.opts.escapeMarkup),t!=undefined&&a.find("div").replaceWith("<div>"+t+"</div>"),s=this.opts.formatSelectionCssClass(e,a.find("div")),s!=undefined&&a.addClass(s),i&&a.find(".select2-search-choice-close").on("mousedown",killEvent).on("click dblclick",this.bind(function(e){this.isInterfaceEnabled()&&($(e.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect($(e.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),killEvent(e))})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),a.data("select2-data",e),a.insertBefore(this.searchContainer),c.push(l),this.setVal(c)},unselect:function(e){var t,s,i=this.getVal();if(e=e.closest(".select2-search-choice"),0===e.length)throw"Invalid argument: "+e+". Must be .select2-search-choice";t=e.data("select2-data"),t&&(s=indexOf(this.id(t),i),s>=0&&(i.splice(s,1),this.setVal(i),this.select&&this.postprocessResults()),e.remove(),this.opts.element.trigger({type:"removed",val:this.id(t),choice:t}),this.triggerChange({removed:t}))},postprocessResults:function(e,t,s){var i=this.getVal(),n=this.results.find(".select2-result"),o=this.results.find(".select2-result-with-children"),a=this;n.each2(function(e,t){var s=a.id(t.data("select2-data"));indexOf(s,i)>=0&&(t.addClass("select2-selected"),t.find(".select2-result-selectable").addClass("select2-selected"))}),o.each2(function(e,t){t.is(".select2-result-selectable")||0!==t.find(".select2-result-selectable:not(.select2-selected)").length||t.addClass("select2-selected")}),-1==this.highlight()&&s!==!1&&a.highlight(0),!this.opts.autocomplete&&!this.opts.createSearchChoice&&!n.filter(".select2-result:not(.select2-selected)").length>0&&(!e||e&&!e.more&&0===this.results.find(".select2-no-results").length)&&checkFormatter(a.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+a.opts.formatNoMatches(a.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-getSideBorderPadding(this.search)},resizeSearch:function(){var e,t,s,i,n,o=getSideBorderPadding(this.search);e=measureTextWidth(this.search)+10,t=this.search.offset().left,s=this.selection.width(),i=this.selection.offset().left,n=s-(t-i)-o,e>n&&(n=s-o),40>n&&(n=s-o),0>=n&&(n=e),this.search.width(n)},getVal:function(){var e;return this.select?(e=this.select.val(),null===e?[]:e):(e=this.opts.element.val(),splitVal(e,this.opts.separator))},setVal:function(e){var t;this.select?this.select.val(e):(t=[],$(e).each(function(){indexOf(this,t)<0&&t.push(this)}),this.opts.element.val(0===t.length?"":t.join(this.opts.separator)))},buildChangeDetails:function(e,t){for(var t=t.slice(0),e=e.slice(0),s=0;s<t.length;s++)for(var i=0;i<e.length;i++)equal(this.opts.id(t[s]),this.opts.id(e[i]))&&(t.splice(s,1),s--,e.splice(i,1),i--);return{added:t,removed:e}},val:function(e,t){var s,i=this;if(0===arguments.length)return this.getVal();if(s=this.data(),s.length||(s=[]),!e&&0!==e)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(t&&this.triggerChange({added:this.data(),removed:s}));if(this.setVal(e),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),t&&this.triggerChange(this.buildChangeDetails(s,this.data()));else{if(this.opts.initSelection===undefined)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(e){var n=$.map(e,i.id);i.setVal(n),i.updateSelection(e),i.clearSearch(),t&&i.triggerChange(this.buildChangeDetails(s,this.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var e=[],t=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){e.push(t.opts.id($(this).data("select2-data")))}),this.setVal(e),this.triggerChange()},data:function(e,t){var s,i,n=this;return 0===arguments.length?this.selection.find(".select2-search-choice").map(function(){return $(this).data("select2-data")}).get():(i=this.data(),e||(e=[]),s=$.map(e,function(e){return n.opts.id(e)}),this.setVal(s),this.updateSelection(e),this.clearSearch(),t&&this.triggerChange(this.buildChangeDetails(i,this.data())),void 0)}}),$.fn.select2=function(){var e,t,s,i,n,o,a=Array.prototype.slice.call(arguments,0),l=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","readonly","positionDropdown","data","search"],c=["val","opened","isFocused","container","data"],r={search:"externalSearch"};return this.each(function(){if(0===a.length||"object"==typeof a[0])e=0===a.length?{}:$.extend({},a[0]),e.element=$(this),"select"===e.element.get(0).tagName.toLowerCase()?n=e.element.prop("multiple"):(o=e.autocomplete||!1,n=e.multiple||!1||o,o&&(e.maximumSelectionSize=1),"tags"in e&&(e.multiple=n=!0)),t=n?new MultiSelect2:new SingleSelect2,t.init(e);else{if("string"!=typeof a[0])throw"Invalid arguments to select2 plugin: "+a;if(indexOf(a[0],l)<0)throw"Unknown method: "+a[0];if(i=undefined,t=$(this).data("select2"),t===undefined)return;if(s=a[0],"container"===s?i=t.container:"dropdown"===s?i=t.dropdown:(r[s]&&(s=r[s]),i=t[s].apply(t,a.slice(1))),indexOf(a[0],c)>=0)return!1}}),i===undefined?this:i},$.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,s,i){var n=[];return markMatch(e.text,s.term,n,i),n.join("")},formatSelection:function(e,t,s){return e?s(e.text):undefined},sortResults:function(e){return e},formatResultCssClass:function(){return undefined},formatSelectionCssClass:function(){return undefined},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){var s=t-e.length;return"Please enter "+s+" more character"+(1==s?"":"s")},formatInputTooLong:function(e,t){var s=e.length-t;return"Please delete "+s+" character"+(1==s?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return(""+t).toUpperCase().indexOf((""+e).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:defaultEscapeMarkup,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(e){return e},adaptDropdownCssClass:function(){return null}},$.fn.select2.ajaxDefaults={transport:$.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch,escapeMarkup:defaultEscapeMarkup},"class":{"abstract":AbstractSelect2,single:SingleSelect2,multi:MultiSelect2}}}}(jQuery);